<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>&gt; 03   &gt; tidying your data</title>
    <meta charset="utf-8" />
    <meta name="author" content="danielle navarro" />
    <meta name="date" content="2020-02-27" />
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <link rel="stylesheet" href="../style/xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="../style/slides-style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# &gt; 03 <br> &gt; tidying your data
## ðŸ§™ bewitch your data! <br> ðŸ”— <a href="https://djnavarro.link/robust-tools">djnavarro.link/robust-tools</a>
### danielle navarro
### 27 feb 2020

---





layout: true
  
&lt;div class="my-footer"&gt;
&lt;span&gt;
&lt;a href="https://djnavarro.link/robust-tools" target="_blank"&gt;djnavarro.link/robust-tools&lt;/a&gt;
&lt;/span&gt;
&lt;/div&gt; 

---







class: middle, inverse

background-image: url("img/purple_heart2.png")
background-size: cover
background-color: #0F4C81

.pull-left-narrow[
  .larger[.embolden[.pink[
    class
    starts
    in...
  ]]]
]
<div class="countdown" id="timer_5e48cdc5" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">01</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

class: middle inverse

.pull-left[

.hand[Data wrangling]

- **What?** Manipulate data
- **Why?** Data are messy
- **How?** With tidyverse!

&lt;img src="img/horst_dplyr.png" width="320" /&gt;

]

---

class: middle, inverse

.pull-left-narrow[
  .huge-blue-number[4]
]
.pull-right-wide[
  .larger[
  Organising data
  ]
]

---

class: inverse
.hand[Import data]


```r
library(tidyverse)
frames &lt;- read_csv(file = "data_reasoning.csv")
```
--

```
## # A tibble: 4,725 x 8
##      id gender   age condition sample_size n_obs test_item
##   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
## 1     1 male      36 category  small           2         1
## 2     1 male      36 category  small           2         2
## 3     1 male      36 category  small           2         3
## 4     1 male      36 category  small           2         4
## 5     1 male      36 category  small           2         5
## 6     1 male      36 category  small           2         6
## # â€¦ with 4,719 more rows, and 1 more variable:
## #   response &lt;dbl&gt;
```


---


class: inverse



```r
mean_resp &lt;- frames %&gt;%
  group_by(test_item, sample_size, n_obs, condition) %&gt;%
  summarise(response = mean(response)) %&gt;%
  ungroup()

*mean_resp %&gt;%
* filter(sample_size == "small")
```

--

- First section creates the summary tibble
- Second section applies a filter...
- ... only retains cases where sample_size = "small"


---
class: inverse
.hand[filter()]


```r
mean_resp 
```

--


```
## # A tibble: 42 x 5
##   test_item sample_size n_obs condition response
##       &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
## 1         1 large          12 category      7.60
## 2         1 large          12 property      7.16
## 3         1 medium          6 category      7.32
## 4         1 medium          6 property      6.66
*## 5         1 small           2 category      6.07
*## 6         1 small           2 property      5.78
## # â€¦ with 36 more rows
```



---
class: inverse
.hand[filter()]


```r
mean_resp %&gt;% 
  filter(sample_size == "small")
```

--


```
## # A tibble: 14 x 5
##   test_item sample_size n_obs condition response
##       &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
*## 1         1 small           2 category      6.07
*## 2         1 small           2 property      5.78
## 3         2 small           2 category      6.26
## 4         2 small           2 property      6.21
## 5         3 small           2 category      5.87
## 6         3 small           2 property      5.24
## # â€¦ with 8 more rows
```



---
class: inverse
.hand[.]


```r
mean_resp %&gt;%
  filter(sample_size == "small")
```

```
## # A tibble: 14 x 5
##   test_item sample_size n_obs condition response
##       &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
*## 1         1 small           2 category      6.07
## 2         1 small           2 property      5.78
*## 3         2 small           2 category      6.26
## 4         2 small           2 property      6.21
## 5         3 small           2 category      5.87
## 6         3 small           2 property      5.24
## # â€¦ with 8 more rows
```


---
class: inverse
.hand[arrange()]


```r
mean_resp %&gt;%
  filter(sample_size == "small") %&gt;%
* arrange(condition)
```

```
## # A tibble: 14 x 5
##   test_item sample_size n_obs condition response
##       &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
*## 1         1 small           2 category      6.07
*## 2         2 small           2 category      6.26
## 3         3 small           2 category      5.87
## 4         4 small           2 category      5.11
## 5         5 small           2 category      4.55
## # â€¦ with 9 more rows
```

---
class: inverse
.hand[select()]


```r
mean_resp %&gt;%
  filter(sample_size == "small") %&gt;%
  arrange(condition) %&gt;%
* select(test_item, condition, response)
```
--

```
## # A tibble: 14 x 3
##   test_item condition response
##       &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
## 1         1 category      6.07
## 2         2 category      6.26
## 3         3 category      5.87
## 4         4 category      5.11
## # â€¦ with 10 more rows
```



---
class: inverse
.hand[store output as a variable]


```r
*mean_resp_small &lt;- mean_resp %&gt;%
  filter(sample_size == "small") %&gt;%
  arrange(condition) %&gt;%
  select(test_item, condition, response)
```

---
class: inverse
.hand[print output from a variable]


```r
mean_resp_small &lt;- mean_resp %&gt;%
  filter(sample_size == "small") %&gt;%
  arrange(condition) %&gt;%
  select(test_item, condition, response)

*print(mean_resp_small, n = 2)
```

```
## # A tibble: 14 x 3
##   test_item condition response
##       &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
## 1         1 category      6.07
## 2         2 category      6.26
## # â€¦ with 12 more rows
```



---
class: inverse
.hand[mutate()]


```r
mean_resp_small %&gt;%
* mutate(generalisation = response/9) %&gt;%
  print(n = 5)
```

```
## # A tibble: 14 x 4
##   test_item condition response generalisation
##       &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;          &lt;dbl&gt;
## 1         1 category      6.07          0.674
## 2         2 category      6.26          0.696
## 3         3 category      5.87          0.652
## 4         4 category      5.11          0.568
## 5         5 category      4.55          0.506
## # â€¦ with 9 more rows
```

---
class: inverse
.hand[mutate() and select()]


```r
mean_resp_small %&gt;%
* mutate(generalisation = response/9) %&gt;%
* select(-response) %&gt;%
  print(n = 4)
```

```
## # A tibble: 14 x 3
##   test_item condition generalisation
##       &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
## 1         1 category           0.674
## 2         2 category           0.696
## 3         3 category           0.652
## 4         4 category           0.568
## # â€¦ with 10 more rows
```


---

class: middle
.hand[Wrangling Exercises #5 and #6]

---

class: middle, inverse

.pull-left-narrow[
  .huge-blue-number[5]
]
.pull-right-wide[
  .larger[
  Pivot
  ]
]


---
class: inverse

```r
long_data &lt;- mean_resp_small %&gt;%
  mutate(generalisation = response/9) %&gt;% 
  select(-response) %&gt;%
  arrange(test_item) %&gt;%
  print(n = 4)
```
--

```
*## # A tibble: 14 x 3
##   test_item condition generalisation
##       &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
*## 1         1 category           0.674
*## 2         1 property           0.643
## 3         2 category           0.696
## 4         2 property           0.690
## # â€¦ with 10 more rows
```


---
class: inverse

```r
wide_data &lt;- long_data %&gt;%
  pivot_wider(
*   names_from = condition,
*   values_from = generalisation
  ) 
```


---
class: inverse

```r
wide_data &lt;- long_data %&gt;%
  pivot_wider(
    names_from = condition, 
    values_from = generalisation 
  ) %&gt;% 
  print(n = 4)
```

```
*## # A tibble: 7 x 3
##   test_item category property
##       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
*## 1         1    0.674    0.643
## 2         2    0.696    0.690
## 3         3    0.652    0.583
## 4         4    0.568    0.521
## # â€¦ with 3 more rows
```


---
class: inverse

```r
wide_data %&gt;% 
  pivot_longer(
*   cols = c(category, property),
*   names_to = "condition",
*   values_to = "generalisation"
  )
```


---
class: inverse

```r
wide_data %&gt;% 
  pivot_longer(
    cols = c(category, property), 
    names_to = "condition", 
    values_to = "generalisation"
  ) %&gt;%
  print(n = 4)
```

```
## # A tibble: 14 x 3
##   test_item condition generalisation
##       &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
## 1         1 category           0.674
## 2         1 property           0.643
## 3         2 category           0.696
## 4         2 property           0.690
## # â€¦ with 10 more rows
```

---

class: middle
.hand[Wrangling Exercise #6]


---

class: middle, inverse

.pull-left-narrow[
  .huge-blue-number[6]
]
.pull-right-wide[
  .larger[
  Combining datasets
  ]
]


---
class: inverse
.hand[sometimes data come in separate files]

```r
# sometimes from two different surveys...
demographics &lt;- read_csv("data_demographics.csv")
experience &lt;- read_csv("data_experience.csv")

# sometimes from two different participants...
results10 &lt;- read_csv("data_results10.csv")
results20 &lt;- read_csv("data_results20.csv")
```



---
class: inverse
.hand[we want to "stack" these vertically...]

```r
results10
```

```
## # A tibble: 60 x 5
##   participant feature    est  true band   
##         &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  
## 1          10 PLCW.6.5     3  1.57 Band 01
## 2          10 PLCY.6.A    15  1.97 Band 01
## 3          10 PLCZ.3.2     8  2.1  Band 01
## 4          10 PUCX.4.b     5  1.10 Band 01
## 5          10 PUCC.8.7    30  1.10 Band 01
## 6          10 PUCF.8.7    30  1.13 Band 01
## # â€¦ with 54 more rows
```


---
class: inverse
.hand[we want to "stack" these vertically...]

```r
results20
```

```
*## # A tibble: 60 x 5
##   participant feature    est  true band   
##         &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  
## 1          20 PLCW.6.5    15  1.57 Band 01
## 2          20 PLCY.6.A    60  1.97 Band 01
## 3          20 PLCZ.3.2    10  2.1  Band 01
## 4          20 PUCX.4.b    65  1.10 Band 01
## 5          20 PUCC.8.7    35  1.10 Band 01
## 6          20 PUCF.8.7    50  1.13 Band 01
## # â€¦ with 54 more rows
```


---
class: inverse
.hand[we want to "stack" these vertically... with **bind_rows()**]

```r
bind_rows(results10, results20)
```

```
*## # A tibble: 120 x 5
##   participant feature    est  true band   
##         &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  
## 1          10 PLCW.6.5     3  1.57 Band 01
## 2          10 PLCY.6.A    15  1.97 Band 01
## 3          10 PLCZ.3.2     8  2.1  Band 01
## 4          10 PUCX.4.b     5  1.10 Band 01
## 5          10 PUCC.8.7    30  1.10 Band 01
## 6          10 PUCF.8.7    30  1.13 Band 01
## # â€¦ with 114 more rows
```

---
class: inverse
.hand[we want to "stack" these vertically... with **bind_rows()**]

```r
bind_rows(results10, results20) %&gt;% arrange(feature)
```

```
## # A tibble: 120 x 5
##   participant feature    est  true band   
##         &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  
*## 1          10 CLCE.2.1    95  99.1 Band 99
*## 2          20 CLCE.2.1    99  99.1 Band 99
## 3          10 CLCF.2.1    80  79.8 Band 75
## 4          20 CLCF.2.1    50  79.8 Band 75
## 5          10 CLCF.6.5    70  50.9 Band 50
## 6          20 CLCF.6.5    65  50.9 Band 50
## # â€¦ with 114 more rows
```



---

class: middle
.hand[Wrangling Exercise #7]



---
class: inverse
.hand[we can stack horizontally with **bind_cols()**]

```r
demographics
```

```
## # A tibble: 2 x 3
##   participant us       age
##         &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1          10 US        33
## 2          20 Non-US    32
```

---
class: inverse
.hand[we can stack horizontally with **bind_cols()**]

```r
experience
```

```
## # A tibble: 2 x 7
##   participant handwriting_expâ€¦ forensic_scientâ€¦
##         &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;           
## 1          10 HW Expert        Yes             
## 2          20 HW Expert        Yes             
## # â€¦ with 4 more variables: forensic_specialty &lt;chr&gt;,
## #   handwriting_reports &lt;dbl&gt;, confidence &lt;dbl&gt;,
## #   familiarity &lt;dbl&gt;
```

---
class: inverse
.hand[we can stack horizontally with **bind_cols()**, though...]

```r
bind_cols(demographics, experience)
```

```
## # A tibble: 2 x 10
##   participant us      age participant1 handwriting_expâ€¦
##         &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;           
## 1          10 US       33           10 HW Expert       
## 2          20 Non-â€¦    32           20 HW Expert       
## # â€¦ with 5 more variables: forensic_scientist &lt;chr&gt;,
## #   forensic_specialty &lt;chr&gt;, handwriting_reports &lt;dbl&gt;,
## #   confidence &lt;dbl&gt;, familiarity &lt;dbl&gt;
```


---
class: inverse
.hand[... we may prefer to "merge" using **full_join()**]

```r
full_join(demographics, experience)
```

```
## Joining, by = "participant"
```

```
## # A tibble: 2 x 9
##   participant us      age handwriting_expâ€¦
##         &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;           
## 1          10 US       33 HW Expert       
## 2          20 Non-â€¦    32 HW Expert       
## # â€¦ with 5 more variables: forensic_scientist &lt;chr&gt;,
## #   forensic_specialty &lt;chr&gt;, handwriting_reports &lt;dbl&gt;,
## #   confidence &lt;dbl&gt;, familiarity &lt;dbl&gt;
```


---
class: inverse
.hand[discussion... what will this do?]

```r
surveys &lt;- full_join(demographics, experience)
results &lt;- full_join(results10, results20)
```



---
class: inverse
.hand[discussion... what will this do?]

```r
surveys %&gt;% print(width = 58)
```

```
## # A tibble: 2 x 9
##   participant us      age handwriting_expâ€¦
##         &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;           
## 1          10 US       33 HW Expert       
## 2          20 Non-â€¦    32 HW Expert       
## # â€¦ with 5 more variables: forensic_scientist &lt;chr&gt;,
## #   forensic_specialty &lt;chr&gt;, handwriting_reports &lt;dbl&gt;,
## #   confidence &lt;dbl&gt;, familiarity &lt;dbl&gt;
```


---
class: inverse
.hand[discussion... what will this do?]

```r
results %&gt;% arrange(feature) %&gt;% print(n = 6)
```

```
## # A tibble: 120 x 5
##   participant feature    est  true band   
##         &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  
## 1          10 CLCE.2.1    95  99.1 Band 99
## 2          20 CLCE.2.1    99  99.1 Band 99
## 3          10 CLCF.2.1    80  79.8 Band 75
## 4          20 CLCF.2.1    50  79.8 Band 75
## 5          10 CLCF.6.5    70  50.9 Band 50
## 6          20 CLCF.6.5    65  50.9 Band 50
## # â€¦ with 114 more rows
```


---
class: inverse
.hand[discussion... what will this do?]

```r
full_join(surveys, results)
```


---
class: inverse
.hand[discussion... what will this do?]

```r
full_join(surveys, results) %&gt;% print(n = 4, width = 58)
```

```
## Joining, by = "participant"
```

```
## # A tibble: 120 x 13
##   participant us      age handwriting_expâ€¦
##         &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;           
## 1          10 US       33 HW Expert       
## 2          10 US       33 HW Expert       
## 3          10 US       33 HW Expert       
## 4          10 US       33 HW Expert       
## # â€¦ with 116 more rows, and 9 more variables:
## #   forensic_scientist &lt;chr&gt;, forensic_specialty &lt;chr&gt;,
## #   handwriting_reports &lt;dbl&gt;, confidence &lt;dbl&gt;,
## #   familiarity &lt;dbl&gt;, feature &lt;chr&gt;, est &lt;dbl&gt;,
## #   true &lt;dbl&gt;, band &lt;chr&gt;
```



---

class: middle
.hand[Wrangling Exercise #8]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "solarized-light",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9",
"slideNumberFormat": "<div class=\"progress-bar-container\">   <div class=\"progress-bar\" style=\"width: calc(%current% / %total% * 100%);\">   </div> </div>`"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
