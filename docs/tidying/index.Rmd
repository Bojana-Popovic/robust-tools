---
title: "> 03 `r emo::ji('broom')` <br> > how to clean up your data"
subtitle: "`r emo::ji('link')` [djnavarro.link/robust-tools](https://djnavarro.link/robust-tools)"
author: "danielle navarro"
date: ""
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["../style/xaringan-themer.css", "../style/slides-style.css"]
    nature:
      highlightStyle: solarized-light
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
      slideNumberFormat: |
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
        </div>`
---

```{r child = "../style/setup.Rmd"}
```

```{r load-packages, message=FALSE, echo=FALSE}
library(countdown)
library(tidyverse)
```

```{r include=FALSE}
hook_source <- knitr::knit_hooks$get('source')
knitr::knit_hooks$set(source = function(x, options) {
  x <- stringr::str_replace(x, "^[[:blank:]]?([^*].+?)[[:blank:]]*#<<[[:blank:]]*$", "*\\1")
  hook_source(x, options)
})

num_fmt <- scales::number_format(big.mark = ",")
```


class: middle, inverse

background-image: url("img/swow_concreteness_fade.jpg")
background-size: cover

.pull-left-narrow[
  .huge-blue-number[1]
]
.pull-right-wide[
  .larger[.embolden[
  Small World of Words
  ]]
]

---

class: inverse

background-image: url("img/swow_concreteness_strongfade.jpg")
background-size: cover


.hand[Import the SWOW data]
--
```{r read-swow, warning=FALSE, message=FALSE, results='hide'}
library(tidyverse)
swow <- read_tsv(file = "data_swow.csv.zip")
```
--
```{r read-swow2, echo=FALSE, warning=FALSE, highlight.output=2}
print(swow, n = 5)
```


---

class: inverse

background-image: url("img/swow_concreteness_strongfade.jpg")
background-size: cover

.hand[Automated name cleaning?]
--
```{r clean-names, warning=FALSE, message=FALSE, results='hide'}
library(janitor)
swow <- clean_names(swow)
```
--
```{r clean-names2, echo=FALSE, warning=FALSE, highlight.output=2}
print(swow, n = 5)
```

---

class: inverse

background-image: url("img/swow_concreteness_strongfade.jpg")
background-size: cover

.hand[Manual name cleaning]
--
```{r renaming, warning=FALSE, message=FALSE, results='hide'}
swow <- swow %>%
  rename(n_response = r1, 
         n_total = n, 
         strength = r1_strength)
```
--
```{r renaming2, echo=FALSE, warning=FALSE, highlight.output=2}
print(swow, n = 3)
```


---

class: inverse, middle

background-image: url("img/swow_concreteness_strongfade.jpg")
background-size: cover

.hand[<span style="font-size:60pt">exercise #1</span>]

- open empty script `exercise_tidying_01.R`
- write your comments at the beginning
- load tidyverse
- load the swow data
- use `rename()` to get new variable names


---


class: middle, inverse

background-image: url("img/filter.jpg")
background-size: cover

.pull-left-narrow[
  .huge-blue-number[2]
]
.pull-right-wide[
  .larger[.embolden[
  Filtering Data
  ]]
]


---

background-image: url("img/filter_fade.jpg")
background-size: cover

.hand[Filter to keep a subset of the data]

- The SWOW data has `r num_fmt(nrow(swow))` rows
- Let's extract the cases when `cue == "woman"`

---

background-image: url("img/filter_fade.jpg")
background-size: cover

.hand[Filter to keep a subset of the data]

--
```{r filter1, warning=FALSE, message=FALSE, results='hide'}
swow %>%
  filter(cue == "woman")
```
--
```{r filter2, echo=FALSE, warning=FALSE}
swow %>%
  filter(cue == "woman") %>%
  print(n = 4)
```



---

background-image: url("img/filter_fade.jpg")
background-size: cover

.hand[Filter to keep a subset of the data]

.pull-left[
```{r filter3, warning=FALSE, message=FALSE, results='hide', fig.show='hide'}
woman_fwd <- swow %>%
  filter(cue == "woman")

ggplot(woman_fwd) + 
  geom_col(aes(
    x = response, 
    y = strength
  ))
```
]
--
.pull-right[
```{r ref.label="filter3", echo=FALSE}
```
]

---

background-image: url("img/filter_fade.jpg")
background-size: cover

.hand[Filter to keep a subset of the data]

.pull-left[
```{r filter4, warning=FALSE, message=FALSE, results='hide', fig.show='hide'}
woman_fwd <- swow %>%
  filter(cue == "woman")

ggplot(woman_fwd) + 
  geom_col(aes(
    x = response, 
    y = strength
  )) + 
  coord_flip()
```
]

.pull-right[
```{r ref.label="filter4", echo=FALSE}
```
]



---

background-image: url("img/filter_fade.jpg")
background-size: cover

.hand[One filter(), then another filter()]

.pull-left[
```{r filter5, warning=FALSE, message=FALSE, results='hide', fig.show='hide'}
woman_fwd <- swow %>%
 filter(cue == "woman") %>%
 filter(n_response > 1)

ggplot(woman_fwd) + 
  geom_col(aes(
    x = response, 
    y = strength
  )) + 
  coord_flip()
```
]

.pull-right[
```{r ref.label="filter5", echo=FALSE}
```
]

---

background-image: url("img/filter_fade.jpg")
background-size: cover

.hand[Two expressions in one filter()]

.pull-left[
```{r filter6, warning=FALSE, message=FALSE, results='hide', fig.show='hide'}
woman_fwd <- swow %>%
  filter(
    cue == "woman",
    n_response > 1
  )

ggplot(woman_fwd) + 
  geom_col(aes(
    x = response, 
    y = strength
  )) + 
  coord_flip()
```
]

.pull-right[
```{r ref.label="filter6", echo=FALSE}
```
]



---

class: inverse, middle

background-image: url("img/filter_fade.jpg")
background-size: cover

.hand[<span style="font-size:60pt">exercise #2</span>]

- open empty script `exercise_tidying_02.R`
- note it picks up from the last exercise
- create `woman_bck` for "backward associates"
- i.e. when `"woman"` is the `response`
- only keep cases with at least two responses


---


class: middle, inverse

background-image: url("img/arrange_dark.jpg")
background-size: cover

.pull-left-narrow[
  .huge-blue-number[3]
]
.pull-right-wide[
  <br>
  .larger[.embolden[.plainwhite[
    Data Arranging
  ]]]
]


---

background-image: url("img/arrange_fade.jpg")
background-size: cover

.hand[The forward data are arranged neatly]

```{r arrange1, warning=FALSE, message=FALSE, results='hide', fig.show='hide'}
swow %>%
  filter(cue == "woman", n_response > 1)
```
```{r arrange1-print, echo=FALSE}
swow %>%
  filter(cue == "woman", n_response > 1) %>%
  print(n = 6)
```


---

background-image: url("img/arrange_fade.jpg")
background-size: cover

.hand[The backward data are not]

```{r arrange2, warning=FALSE, message=FALSE, results='hide', fig.show='hide'}
swow %>%
  filter(response == "woman", n_response > 1)
```
```{r arrange2-print, echo=FALSE}
swow %>%
  filter(response == "woman", n_response > 1) %>%
  print(n = 6)
```


---

background-image: url("img/arrange_fade.jpg")
background-size: cover

.hand[Lets arrange() them]

```{r arrange3, warning=FALSE, message=FALSE, results='hide', fig.show='hide'}
swow %>%
  filter(response == "woman", n_response > 1) %>%
  arrange(strength)
```
--
```{r arrange3-print, echo=FALSE}
swow %>%
  filter(response == "woman", n_response > 1) %>%
  arrange(strength) %>%
  print(n = 5)
```


---

background-image: url("img/arrange_fade.jpg")
background-size: cover

.hand[Lets arrange() them, in descending order]

```{r arrange4, warning=FALSE, message=FALSE, results='hide', fig.show='hide'}
swow %>%
  filter(response == "woman", n_response > 1) %>%
  arrange(desc(strength))
```

```{r arrange4-print, echo=FALSE}
swow %>%
  filter(response == "woman", n_response > 1) %>%
  arrange(desc(strength)) %>%
  print(n = 5)
```


---

class: inverse, middle

background-image: url("img/arrange_fade.jpg")
background-size: cover

.hand[<span style="font-size:60pt">exercise #3</span>]

- open script `exercise_tidying_03.R`
- fix filtering: retain *all* responses for `woman_fwd` and `women_bck`
- create analogous data sets `man_fwd` and `man_bck`
- arrange all data sets by descending `strength`

---

class: middle, inverse

background-image: url("img/select_dark.jpg")
background-size: cover

.pull-left-narrow[
  .huge-blue-number[4]
]
.pull-right-wide[
  <br>
  .larger[.embolden[.plainwhite[
    &nbsp;&nbsp;Variable<br>&nbsp;&nbsp;Selection
  ]]]
]

---

background-image: url("img/select_fade.jpg")
background-size: cover

.hand[Select cue, response and strength]

```{r select1, warning=FALSE, message=FALSE, results='hide', fig.show='hide'}
swow %>%
  filter(response == "woman") %>%
  arrange(desc(strength)) %>%
  select(cue, response, strength) #<<
```

--

```{r select1-print, echo=FALSE}
swow %>%
  filter(response == "woman") %>%
  arrange(desc(strength)) %>%
  select(cue, response, strength) %>%
  print(n = 3)
```


---

background-image: url("img/select_fade.jpg")
background-size: cover

.hand[Alternative method]


```{r select2, warning=FALSE, message=FALSE, results='hide', fig.show='hide'}
swow %>%
  filter(response == "woman") %>%
  arrange(desc(strength)) %>%
  select(-n_response, -n_total) #<<
```

--

```{r select2-print, echo=FALSE}
swow %>%
  filter(response == "woman") %>%
  arrange(desc(strength)) %>%
  select(-n_response, -n_total) %>%
  print(n = 3)
```


---

class: inverse, middle

background-image: url("img/select_fade.jpg")
background-size: cover

.hand[<span style="font-size:60pt">exercise #4</span>]

- open script `exercise_tidying_04.R`
- for each data set: `woman_fwd`, `women_bck`, `man_fwd` and `man_bck`
- create dataset using `filter()` 
- sort rows by descending `strength` using `arrange()` and `desc()`
- use `select()` reduce to three columns: `cue`, `response` and `strength`















---


class: inverse
.hand[Import data]

```{r read-data, warning=FALSE, message=FALSE, results='hide'}
library(tidyverse)
frames <- read_csv(file = "data_reasoning.csv")
```
--
```{r read-data2, echo=FALSE, warning=FALSE}
print(frames, n = 6, width = 59)
```


---


class: inverse


```{r average-response, results='hide'}
mean_resp <- frames %>%
  group_by(test_item, sample_size, n_obs, condition) %>%
  summarise(response = mean(response)) %>%
  ungroup()

mean_resp %>% #<<
  filter(sample_size == "small") #<<
```

--

- First section creates the summary tibble
- Second section applies a filter...
- ... only retains cases where sample_size = "small"


---
class: inverse
.hand[filter()]

```{r, results='hide', highlight.output = c(4,5)}
mean_resp 
```

--

```{r average-response2c, echo=FALSE, highlight.output = c(8,9)}
mean_resp %>% 
  print(n=6)
```



---
class: inverse
.hand[filter()]

```{r average-response2, results='hide', highlight.output = c(4,5)}
mean_resp %>% 
  filter(sample_size == "small")
```

--

```{r average-response2b, echo=FALSE, highlight.output = c(4,5)}
mean_resp %>% 
  filter(sample_size == "small") %>%
  print(n=6)
```



---
class: inverse
.hand[.]

```{r, results='hide'}
mean_resp %>%
  filter(sample_size == "small")
```
```{r, echo=FALSE, highlight.output = c(4,6)}
mean_resp %>%
  filter(sample_size == "small") %>%
  print(n=6)
```


---
class: inverse
.hand[arrange()]

```{r, results='hide'}
mean_resp %>%
  filter(sample_size == "small") %>%
  arrange(condition) #<<
```
```{r, echo=FALSE, highlight.output = 4:5}
mean_resp %>%
  filter(sample_size == "small") %>%
  arrange(condition) %>%
  print(n=5)
```

---
class: inverse
.hand[select()]

```{r, results='hide'}
mean_resp %>%
  filter(sample_size == "small") %>%
  arrange(condition) %>%
  select(test_item, condition, response) #<<
```
--
```{r, echo=FALSE}
mean_resp %>%
  filter(sample_size == "small") %>%
  arrange(condition) %>%
  select(test_item, condition, response) %>%
  print(n=4)
```



---
class: inverse
.hand[store output as a variable]

```{r, eval=TRUE}
mean_resp_small <- mean_resp %>% #<<
  filter(sample_size == "small") %>%
  arrange(condition) %>%
  select(test_item, condition, response)
```

---
class: inverse
.hand[print output from a variable]

```{r, eval=TRUE}
mean_resp_small <- mean_resp %>%
  filter(sample_size == "small") %>%
  arrange(condition) %>%
  select(test_item, condition, response)

print(mean_resp_small, n = 2) #<<
```



---
class: inverse
.hand[mutate()]

```{r, eval=TRUE}
mean_resp_small %>%
  mutate(generalisation = response/9) %>% #<<
  print(n = 5)
```

---
class: inverse
.hand[mutate() and select()]

```{r, eval=TRUE}
mean_resp_small %>%
  mutate(generalisation = response/9) %>% #<<
  select(-response) %>% #<<
  print(n = 4)
```


---

class: middle
.hand[Wrangling Exercises #5 and #6]

---

class: middle, inverse

.pull-left-narrow[
  .huge-blue-number[5]
]
.pull-right-wide[
  .larger[
  Pivot
  ]
]


---
class: inverse
```{r setup_reshape, results='hide'}
long_data <- mean_resp_small %>%
  mutate(generalisation = response/9) %>% 
  select(-response) %>%
  arrange(test_item) %>%
  print(n = 4)
```
--
```{r ref.label="setup_reshape", echo=FALSE, highlight.output = c(1,4,5)}
```


---
class: inverse
```{r, results='hide'}
wide_data <- long_data %>%
  pivot_wider(
    names_from = condition, #<< 
    values_from = generalisation #<<
  ) 
```


---
class: inverse
```{r, eval=TRUE, highlight.output = c(1,4)}
wide_data <- long_data %>%
  pivot_wider(
    names_from = condition, 
    values_from = generalisation 
  ) %>% 
  print(n = 4)
```


---
class: inverse
```{r, results='hide'}
wide_data %>% 
  pivot_longer(
    cols = c(category, property), #<<
    names_to = "condition", #<<
    values_to = "generalisation" #<<
  )
```


---
class: inverse
```{r, eval=TRUE}
wide_data %>% 
  pivot_longer(
    cols = c(category, property), 
    names_to = "condition", 
    values_to = "generalisation"
  ) %>%
  print(n = 4)
```

---

class: middle
.hand[Wrangling Exercise #6]


---

class: middle, inverse

.pull-left-narrow[
  .huge-blue-number[6]
]
.pull-right-wide[
  .larger[
  Combining datasets
  ]
]


---
class: inverse
.hand[sometimes data come in separate files]
```{r, message=FALSE}
# sometimes from two different surveys...
demographics <- read_csv("data_demographics.csv")
experience <- read_csv("data_experience.csv")

# sometimes from two different participants...
results10 <- read_csv("data_results10.csv")
results20 <- read_csv("data_results20.csv")
```



---
class: inverse
.hand[we want to "stack" these vertically...]
```{r, eval=FALSE}
results10
```
```{r, echo=FALSE}
print(results10, n = 6)
```


---
class: inverse
.hand[we want to "stack" these vertically...]
```{r, eval=FALSE}
results20
```
```{r, echo=FALSE, highlight.output=1}
print(results20, n = 6)
```


---
class: inverse
.hand[we want to "stack" these vertically... with **bind_rows()**]
```{r, eval=FALSE}
bind_rows(results10, results20)
```
```{r, echo=FALSE, highlight.output=1}
print(bind_rows(results10, results20), n = 6)
```

---
class: inverse
.hand[we want to "stack" these vertically... with **bind_rows()**]
```{r, eval=FALSE}
bind_rows(results10, results20) %>% arrange(feature)
```
```{r, echo=FALSE, highlight.output=4:5}
print(bind_rows(results10, results20) %>% arrange(feature), n = 6)
```



---

class: middle
.hand[Wrangling Exercise #7]



---
class: inverse
.hand[we can stack horizontally with **bind_cols()**]
```{r, message=FALSE}
demographics
```

---
class: inverse
.hand[we can stack horizontally with **bind_cols()**]
```{r, eval=FALSE}
experience
```
```{r, echo=FALSE}
print(experience, width=58)
```

---
class: inverse
.hand[we can stack horizontally with **bind_cols()**, though...]
```{r, eval=FALSE}
bind_cols(demographics, experience)
```
```{r, echo=FALSE}
survey <- bind_cols(demographics, experience)
print(survey, width=58)
```


---
class: inverse
.hand[... we may prefer to "merge" using **full_join()**]
```{r, eval=FALSE}
full_join(demographics, experience)
```
```{r, echo=FALSE}
survey <- full_join(demographics, experience)
print(survey, width=58)
```


---
class: inverse
.hand[discussion... what will this do?]
```{r, results='hide', message = FALSE}
surveys <- full_join(demographics, experience)
results <- full_join(results10, results20)
```



---
class: inverse
.hand[discussion... what will this do?]
```{r}
surveys %>% print(width = 58)
```


---
class: inverse
.hand[discussion... what will this do?]
```{r}
results %>% arrange(feature) %>% print(n = 6)
```


---
class: inverse
.hand[discussion... what will this do?]
```{r, eval=FALSE}
full_join(surveys, results)
```


---
class: inverse
.hand[discussion... what will this do?]
```{r}
full_join(surveys, results) %>% print(n = 4, width = 58)
```



---

class: middle
.hand[Wrangling Exercise #8]











