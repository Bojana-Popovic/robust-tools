---
title: "> week 02 <br> > data wrangling"
subtitle: "`r emo::ji('mage')` bewitch your data! <br> `r emo::ji('link')` [djnavarro.link/robust-tools](https://djnavarro.link/robust-tools)"
author: "danielle navarro"
date: "27 feb 2020"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["../style/xaringan-themer.css", "../style/slides-style.css"]
    nature:
      highlightStyle: solarized-light
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
      slideNumberFormat: |
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
        </div>`
---

```{r child = "../style/setup.Rmd"}
```

```{r load-packages, message=FALSE, echo=FALSE}
library(countdown)
library(tidyverse)
```

```{r include=FALSE}
hook_source <- knitr::knit_hooks$get('source')
knitr::knit_hooks$set(source = function(x, options) {
  x <- stringr::str_replace(x, "^[[:blank:]]?([^*].+?)[[:blank:]]*#<<[[:blank:]]*$", "*\\1")
  hook_source(x, options)
})
```



class: middle, inverse

background-image: url("img/purple_heart2.png")
background-size: cover
background-color: #0F4C81

.pull-left-narrow[
  .larger[.embolden[.pink[
    class
    starts
    in...
  ]]]
]
```{r echo=FALSE}
countdown(minutes = 1, color_background = "white")
```

---

class: middle inverse

.pull-left[

.hand[Data wrangling]

- **What?** Manipulate data
- **Why?** Data are messy
- **How?** With tidyverse!

```{r, echo=FALSE}
knitr::include_graphics("img/horst_dplyr.png")
```

]


---

class: middle

.pull-left-narrow[
  .huge-blue-number[1]
]
.pull-right-wide[
  .larger[
  The reasoning data
  ]
]

---

class: middle
.hand[Property sampling: the robot only detects plaxium spheres]
```{r, echo=FALSE}
knitr::include_graphics("img/data10_property.jpg")
```


---

class: middle
.hand[Category sampling: the robot only tests small spheres]
```{r, echo=FALSE}
knitr::include_graphics("img/data10_category.jpg")
```


---

class: middle
.hand[Small sample size: Elicit judgments after two observations]
```{r, echo=FALSE}
knitr::include_graphics("img/data2_property.jpg")
```

---

class: middle
.hand[Medium sample size: Elicit judgments after six observations]
```{r, echo=FALSE}
knitr::include_graphics("img/data6_property.jpg")
```

---

class: middle
.hand[Large sample size: Elicit judgments after twelve observations]
```{r, echo=FALSE}
knitr::include_graphics("img/data12_property.jpg")
```


---

class: middle
.hand[Seven test items that vary in size: Smallest...]
```{r, echo=FALSE}
knitr::include_graphics("img/test2.jpg")
```

---

class: middle
.hand[Seven test items that vary in size: Largest...]
```{r, echo=FALSE}
knitr::include_graphics("img/test8.jpg")
```

---

class: middle, inverse

.pull-left-narrow[
  .huge-blue-number[2]
]
.pull-right-wide[
  .larger[
  Meeting the data
  ]
]


---

class: inverse
.hand[Importing the data!]

```{r read-data, warning=FALSE, message=FALSE}
library(tidyverse)
frames <- read_csv(file = "data_reasoning.csv")
```
--
```{r ref.label="read-data", echo=FALSE, warning=FALSE}
```


---

class: inverse
.hand[Inspecting the data]
```{r print-data, warning=FALSE, message=FALSE, results='hide'}
print(frames)
```
--
```{r, echo=FALSE, warning=FALSE}
print(frames, n = 6, width = 59)
```


---

class: inverse
.hand[Inspecting the data]
```{r glimpse-data, warning=FALSE, message=FALSE, results='hide'}
glimpse(frames)
```
--
```{r, echo=FALSE, warning=FALSE}
glimpse(frames, width = 59)
```

---

class: middle
.hand[Wrangling Exercise #1]

---

class: middle, inverse

.pull-left-narrow[
  .huge-blue-number[2]
]
.pull-right-wide[
  .larger[
  Meeting the pipe
  ]
]


---

class: inverse

<br><br><br>
.hand[The pipe, %>%]

.pull-left[
- Take the frames data...
- Do one thing...
- Then another...
- And then one more...
]
--
.pull-right[
```{}
frames %>%
  do_one_thing(.) %>%
  then_another(.) %>%
  and_then_one_more(.)
```
]


---

class: middle, inverse

.hand[Piping is a good abstraction]

.pull-left-wide[
```{}
data %>% 
  tidy() %>%
  describe() %>%
  visualise() %>%
  analyse()
```

- We "pipe" our data through operations
- The data set *flows* through our analysis
]

---

class: middle
.hand[Wrangling Exercise #2]

---

class: middle, inverse

.pull-left-narrow[
  .huge-blue-number[3]
]
.pull-right-wide[
  .larger[
  Group and
  summarise
  ]
]

---

class: middle, inverse 
.pull-left-wide[
.hand[The basic idea]

```{r, eval=FALSE}
frames %>%
  group_by( GROUP ) %>%
  summarise( EXPRESSION ) %>%
  ungroup()
```

- use `group_by` to define groups
- use `summarise` to... summarise
- use `ungroup` to remove grouping
]


---
class: inverse

.hand[Group, summarise...]

```{r frames-group, results='hide'}
frames %>%
  group_by(test_item, sample_size, n_obs, condition) %>%
  summarise(response = mean(response))
```
--
```{r, echo=FALSE, highlight.output=2:3}
frames %>%
  group_by(test_item, sample_size, n_obs, condition) %>%
  summarise(response = mean(response)) %>%
  print(n = 4)
```


---
class: inverse

.hand[Group, summarise, and ungroup]

```{r frames-group-2, results='hide'}
frames %>%
  group_by(test_item, sample_size, n_obs, condition) %>%
  summarise(response = mean(response)) %>%
  ungroup() #<<
```

```{r, echo=FALSE, highlight.output=2}
frames %>%
  group_by(test_item, sample_size, n_obs, condition) %>%
  summarise(response = mean(response)) %>%
  ungroup() %>%
  print(n = 4)
```

---
class: inverse

.hand[A more realistic example]
.pull-left[
```{r summarise-real, results='hide'}
frames %>% 
  group_by(test_item) %>%
  summarise(
    m = mean(response), #<<
    s = sd(response), #<<
    n = n() #<<
  ) %>%
  ungroup()
```
]
--
.pull-right[
```{r ref.label="summarise-real", echo=FALSE}
```
]

???
- these are bad variable names
- i've done it to fit the slides
- don't do it in real life

---

class: middle
.hand[Wrangling Exercise #3 and #4]

---

class: middle, inverse

.pull-left-narrow[
  .huge-blue-number[4]
]
.pull-right-wide[
  .larger[
  Organising data
  ]
]


---


class: inverse


```{r average-response, results='hide'}
mean_resp <- frames %>%
  group_by(test_item, sample_size, n_obs, condition) %>%
  summarise(response = mean(response)) %>%
  ungroup()

mean_resp %>% #<<
  filter(sample_size == "small") #<<
```

--

- First section creates the summary tibble
- Second section applies a filter...
- ... only retains cases where sample_size = "small"


---
class: inverse
.hand[filter()]

```{r, results='hide', highlight.output = c(4,5)}
mean_resp 
```

--

```{r average-response2c, echo=FALSE, highlight.output = c(8,9)}
mean_resp %>% 
  print(n=6)
```



---
class: inverse
.hand[filter()]

```{r average-response2, results='hide', highlight.output = c(4,5)}
mean_resp %>% 
  filter(sample_size == "small")
```

--

```{r average-response2b, echo=FALSE, highlight.output = c(4,5)}
mean_resp %>% 
  filter(sample_size == "small") %>%
  print(n=6)
```



---
class: inverse
.hand[.]

```{r, results='hide'}
mean_resp %>%
  filter(sample_size == "small")
```
```{r, echo=FALSE, highlight.output = c(4,6)}
mean_resp %>%
  filter(sample_size == "small") %>%
  print(n=6)
```


---
class: inverse
.hand[arrange()]

```{r, results='hide'}
mean_resp %>%
  filter(sample_size == "small") %>%
  arrange(condition) #<<
```
```{r, echo=FALSE, highlight.output = 4:5}
mean_resp %>%
  filter(sample_size == "small") %>%
  arrange(condition) %>%
  print(n=5)
```

---
class: inverse
.hand[select()]

```{r, results='hide'}
mean_resp %>%
  filter(sample_size == "small") %>%
  arrange(condition) %>%
  select(test_item, condition, response) #<<
```
--
```{r, echo=FALSE}
mean_resp %>%
  filter(sample_size == "small") %>%
  arrange(condition) %>%
  select(test_item, condition, response) %>%
  print(n=4)
```



---
class: inverse
.hand[store output as a variable]

```{r, eval=TRUE}
mean_resp_small <- mean_resp %>% #<<
  filter(sample_size == "small") %>%
  arrange(condition) %>%
  select(test_item, condition, response)
```

---
class: inverse
.hand[print output from a variable]

```{r, eval=TRUE}
mean_resp_small <- mean_resp %>%
  filter(sample_size == "small") %>%
  arrange(condition) %>%
  select(test_item, condition, response)

print(mean_resp_small, n = 2) #<<
```



---
class: inverse
.hand[mutate()]

```{r, eval=TRUE}
mean_resp_small %>%
  mutate(generalisation = response/9) %>% #<<
  print(n = 5)
```

---
class: inverse
.hand[mutate() and select()]

```{r, eval=TRUE}
mean_resp_small %>%
  mutate(generalisation = response/9) %>% #<<
  select(-response) %>% #<<
  print(n = 4)
```


---

class: middle
.hand[Wrangling Exercises #4 and #5]

---

class: middle, inverse

.pull-left-narrow[
  .huge-blue-number[5]
]
.pull-right-wide[
  .larger[
  Reshaping data
  ]
]


---
class: inverse
.hand[long form data]

```{r, eval=TRUE}
long_avrs <- mean_resp_small %>%
  mutate(generalisation = response/9) %>% 
  select(-response) 

long_avrs
```

---
class: inverse
.hand[spread to wide form]

```{r, eval=TRUE}
wide_avrs <- long_avrs %>%
  spread(key = condition, value = generalisation) #<<

wide_avrs
```

---
class: inverse
.hand[gather to long form]

```{r, eval=TRUE}
wide_avrs %>% 
  gather(key = "condition", value = "generalisation", category, property) #<<
```

---

class: middle
.hand[Wrangling Exercise #6]

